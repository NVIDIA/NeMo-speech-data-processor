documentation: |
  YODAS2 
  ############
  Documentation is in progress.

use_dask: False

params:
  source_lang: es
  use_regex: ${.source_lang}
  translation: True
  convert_to_audio_tarred_dataset:
    should_run: True
    num_shards: 16
    buckets_num: 1
    min_audio_duration: 0.1
    max_audio_duration: 40.0
  save_disk_space: True

processors_to_run: "2:"
workspace_dir: /data3/sdp_test/new_test_kurz #/data3/sdp_test/final_test
sdp_dir: /ameister/YODAS_PR_FINAL/NeMo-speech-data-processor

processors:
  - _target_: sdp.processors.GetGranarysYodas2
    output_manifest_file: ${workspace_dir}/${params.source_lang}/manifest_0.json
    lang: ${params.source_lang}
    translation: ${params.translation}

  - _target_: sdp.processors.SubRegex
    text_key: text
    regex_params_yaml: ${sdp_dir}/dataset_configs/multilingual/granary/partials/subregex_params/${params.use_regex}.yaml
    output_manifest_file: ${workspace_dir}/${params.source_lang}/manifest_1.json
  
  - _target_: sdp.processors.DropIfRegexMatch
    output_manifest_file: ${workspace_dir}/${params.source_lang}/manifest_2.json
    text_key: text
    regex_patterns:
      - "^\\s*$"
  
  - _target_: sdp.processors.DownloadYodas2Data
    #by pattern
    output_manifest_file: ${workspace_dir}/${params.source_lang}/manifest_3.json
    local_dir: ${workspace_dir}/${params.source_lang}
    max_workers: 8
  
  - _target_: sdp.processors.ExtractTar
    output_manifest_file: ${workspace_dir}/${params.source_lang}/manifest_4.json
    field_to_tar_filepath: 'local_audio'
    extraction_dir: ${workspace_dir}/${params.source_lang}
    remove_source_tar: ${params.save_disk_space}
    filepath_prefix_field: 'lang_subset'
    output_filepath_field: 'extracted_audios'
    get_extracted_filepaths: True
  
  - _target_: sdp.processors.CreateInitialManifestYodas2
    output_manifest_file: ${workspace_dir}/${params.source_lang}/manifest_5.json
    field_with_list: 'extracted_audios'
    output_field: 'source_audio_filepath'

#export HYDRA_FULL_ERROR=1 && python /ameister/YODAS_PR_FINAL/NeMo-speech-data-processor/main.py --config-path=/ameister/YODAS_PR_FINAL/NeMo-speech-data-processor/dataset_configs/multilingual/granary/ --config-name=yodas2_express.yaml